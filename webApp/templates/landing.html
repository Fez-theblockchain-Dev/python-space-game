{% extends 'base.html' %}
{% load static %}


{% block content %}
<section class="hero">
    <div class="container">
        <div class="hero-content">
            <div class="hero-text">
                <h1>Conquer the <span>Galaxy</span></h1>
                <p>Battle alien forces across the cosmos in this action-packed space shooter. Upgrade your ship, collect gold coins, and become the ultimate space commander.</p>
                <div class="hero-buttons">
                    <a href="/shop/" class="btn btn-primary">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M21 4H3a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1zm-1 11H4v-2h16v2zm0-4H4V8h16v3z"/></svg>
                        Buy Power-Ups
                    </a>
                    <a href="#packages" class="btn btn-secondary">View Packages</a>
                </div>
                <!-- Player Wallet Display -->
                <div id="wallet-display" class="wallet-display" style="margin-top: 16px; display: flex; gap: 16px; font-size: 14px;">
                    <span>ü™ô <span id="wallet-gold">0</span> Gold</span>
                    <span>üíö <span id="wallet-health">0</span> Health</span>
                </div>
            </div>
            <div class="hero-visual">
                <img src="/assets/main_menu_background.png" alt="Space Game" class="hero-image" onerror="this.style.display='none'">
            </div>
        </div>
    </div>
</section>

<section class="packages-section" id="packages">
    <div class="container">
        <div class="section-header">
            <h2>Power Up Your Journey</h2>
            <p>Choose from our selection of game-enhancing packages</p>
        </div>

        <!-- Quick Multi-Item Checkout Form -->
        <div class="card" style="margin-bottom: 24px;">
            <h3 style="margin-top: 0;">Quick Checkout</h3>
            <p style="color: #a0a0a0; margin-bottom: 16px; font-size: 14px;">
                Select packages from each category to add to your cart.
            </p>
            <form id="quick-checkout-form" style="display: grid; gap: 12px; max-width: 520px;">
                <label for="select-gold-coins">Gold Coins Package</label>
                <select id="select-gold-coins" name="gold_coins">
                    <option value="">-- Select Gold Package (optional) --</option>
                    {% for package in packages %}
                    {% if package.gold_coins > 0 %}
                    <option value="{{ package.id }}">{{ package.name }} ‚Äî ${{ package.price }} (ü™ô {{ package.gold_coins }})</option>
                    {% endif %}
                    {% endfor %}
                </select>

                <label for="select-health-packs">Health Packs Package</label>
                <select id="select-health-packs" name="health_packs">
                    <option value="">-- Select Health Package (optional) --</option>
                    {% for package in packages %}
                    {% if package.health_packs > 0 %}
                    <option value="{{ package.id }}">{{ package.name }} ‚Äî ${{ package.price }} (üíö {{ package.health_packs }})</option>
                    {% endif %}
                    {% endfor %}
                </select>

                <label for="checkout-quantity">Quantity (applies to each)</label>
                <input id="checkout-quantity" name="quantity" type="number" min="1" max="99" value="1" required>

                <button type="submit" class="btn btn-primary">
                    <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 8px;"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
                    Proceed to Checkout
                </button>
                <div id="checkout-error" style="color: #ff6b6b; display: none; padding: 8px; background: rgba(255,107,107,0.1); border-radius: 4px;"></div>
            </form>
        </div>
        
        <div class="packages-grid">
            {% for package in packages %}
            <div class="card package-card {% if package.id == 'starter_bundle' %}featured{% endif %}">
                <div class="package-icon {% if package.gold_coins > 0 and package.health_packs > 0 %}bundle{% elif package.gold_coins > 0 %}gold{% else %}health{% endif %}">
                    <div></div>
                </div>
                <h3 class="package-name">{{ package.name }}</h3>
                <p class="package-desc">
                    {% if package.gold_coins > 0 and package.health_packs > 0 %}
                    The ultimate starter pack
                    {% elif package.gold_coins > 0 %}
                    Upgrade your arsenal
                    {% else %}
                    Stay in the fight longer
                    {% endif %}
                </p>
                <div class="package-rewards">
                    {% if package.gold_coins > 0 %}
                    <span class="reward-badge gold">ü™ô {{ package.gold_coins }} Gold</span>
                    {% endif %}
                    {% if package.health_packs > 0 %}
                    <span class="reward-badge health">üíö {{ package.health_packs }} Health</span>
                    {% endif %}
                </div>
                <div class="package-price">${{ package.price }} <span>USD</span></div>
                <a href="#" class="btn btn-primary js-package-checkout" data-package-id="{{ package.id }}">Buy Now</a>
            </div>
            {% endfor %}
        </div>
        
        <div class="applepay-banner">
            <h3>Fast & Secure Checkout</h3>
            <p>Pay instantly with Apple Pay, Google Pay, or card</p>
            <div class="payment-methods">
                <span class="payment-method">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/></svg>
                    Apple Pay
                </span>
                <span class="payment-method">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .307 5.387.307 12s5.56 12 12.173 12c3.573 0 6.267-1.173 8.373-3.36 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.053H12.48z"/></svg>
                    Google Pay
                </span>
                <span class="payment-method">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/></svg>
                    Card
                </span>
            </div>
        </div>
    </div>
</section>

<section class="features-section">
    <div class="container">
        
        <div class="features-grid">
            <div class="card feature-card">
                <div class="feature-icon">üîí</div>
                <h3>Secure Payments</h3>
                <p>All transactions are protected with industry-leading encryption powered by Stripe.</p>
            </div>
            <div class="card feature-card">
                <div class="feature-icon">‚ö°</div>
                <h3>Instant Delivery</h3>
                <p>Your gold coins and health packs are credited to your account immediately after purchase.</p>
            </div>
            <div class="card feature-card">
                <div class="feature-icon">üåç</div>
                <h3>Global Access</h3>
                <p>Available in supported countries with multiple payment methods including Apple Pay.</p>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
  // ============================================================================
  // Stripe Payment Integration Configuration
  // ============================================================================
  // API Endpoints:
  //   POST /api/create-checkout-session/  - Create Stripe Checkout (redirects to hosted page)
  //   POST /api/create-payment-intent/    - Create PaymentIntent (for Express Checkout/Apple Pay)
  //   POST /api/stripe-webhook/           - Webhook endpoint for Stripe events
  //   GET  /payment/success/              - Success page after payment
  //   GET  /payment/cancelled/            - Cancelled payment page
  // ============================================================================

  // Global configuration - passed from Django template
  window.__SPACEGAME_STRIPE_PUBLISHABLE_KEY__ = "{{ stripe_publishable_key|escapejs }}";
  window.__SPACEGAME_PLAYER_UUID__ = "{{ player_uuid|default:''|escapejs }}";

  // API endpoint configuration
  window.__SPACEGAME_API__ = {
    createCheckoutSession: "/api/create-checkout-session/",
    createPaymentIntent: "/api/create-payment-intent/",
    stripeWebhook: "/api/stripe-webhook/",
    paymentSuccess: "/payment/success/",
    paymentCancelled: "/payment/cancelled/"
  };

  window.addEventListener("DOMContentLoaded", function () {
    var API = window.__SPACEGAME_API__;

    // Setup dual-select checkout form (Gold Coins + Health Packs)
    if (window.SpaceGameStripe && typeof window.SpaceGameStripe.setupDualSelectCheckout === "function") {
      window.SpaceGameStripe.setupDualSelectCheckout({
        formId: "quick-checkout-form",
        goldSelectId: "select-gold-coins",
        healthSelectId: "select-health-packs",
        quantityInputId: "checkout-quantity",
        errorId: "checkout-error",
        createCheckoutUrl: API.createCheckoutSession
      });
    }

    // Setup individual package "Buy Now" buttons
    if (window.SpaceGameStripe && typeof window.SpaceGameStripe.setupPackageCheckout === "function") {
      window.SpaceGameStripe.setupPackageCheckout({
        buttonSelector: ".js-package-checkout",
        errorId: "checkout-error",
        createCheckoutUrl: API.createCheckoutSession
      });
    }

    // Setup wallet balance display
    if (window.SpaceGameStripe && typeof window.SpaceGameStripe.setupWalletDisplay === "function") {
      window.SpaceGameStripe.setupWalletDisplay({
        walletUrl: "/api/wallet/balance/",
        goldDisplayId: "wallet-gold",
        healthDisplayId: "wallet-health"
      });
    }
  });
</script>
{% endblock %}

